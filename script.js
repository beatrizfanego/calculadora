const empreendimentos = {
  Mônaco: {
    plantas: [
      "APTO 202, 2 suítes, 1 vaga, 73,45m² privativo",
      "APTO 301, 2 suítes, 1 vaga, 73,25m² privativo",
      "APTO 303, 2 suítes, 1 vaga, 77,05m² privativo",
      "APTO 401, 2 suítes, 1 vaga, 73,25m² privativo",
      "APTO 403, 2 suítes, 1 vaga, 77,05m² privativo",
      "APTO 502, 2 suítes, 1 vaga, 73,45m² privativo",
      "APTO 602, 2 suítes, 1 vaga, 73,45m² privativo",
      "APTO 1002, 2 suítes, 1 vaga, 73,45m² privativo",
      "APTO 1004, 2 suítes, 1 vaga, 79,55m² privativo",
      "APTO 1101, 2 suítes, 1 vaga, 73,25m² privativo",
      "APTO 1102, 2 suítes, 1 vaga, 73,45m² privativo",
      "APTO 1104, 2 suítes, 1 vaga, 79,55m² privativo",
      "APTO 1201, 2 suítes, 1 vaga, 73,25m² privativo",
      "APTO 1203, 2 suítes, 1 vaga, 77,05m² privativo",
      "APTO 1204, 2 suítes, 1 vaga, 79,55m² privativo",
      "APTO 1301, 2 suítes, 1 vaga, 73,25m² privativo",
      "APTO 1302, 2 suítes, 1 vaga, 73,45m² privativo",
    ],
    valores: {
      "APTO 202, 2 suítes, 1 vaga, 73,45m² privativo": 916744.44,
      "APTO 301, 2 suítes, 1 vaga, 73,25m² privativo": 919645.53,
      "APTO 303, 2 suítes, 1 vaga, 77,05m² privativo": 867425.91,
      "APTO 401, 2 suítes, 1 vaga, 73,25m² privativo": 934150.98,
      "APTO 403, 2 suítes, 1 vaga, 77,05m² privativo": 881931.36,
      "APTO 502, 2 suítes, 1 vaga, 73,45m² privativo": 960260.79,
      "APTO 602, 2 suítes, 1 vaga, 73,45m² privativo": 974766.24,
      "APTO 1002, 2 suítes, 1 vaga, 73,45m² privativo": 1032788.04,
      "APTO 1004, 2 suítes, 1 vaga, 79,55m² privativo": 974766.24,
      "APTO 1101, 2 suítes, 1 vaga, 73,25m² privativo": 1035689.13,
      "APTO 1102, 2 suítes, 1 vaga, 73,45m² privativo": 1047293.49,
      "APTO 1104, 2 suítes, 1 vaga, 79,55m² privativo": 989271.69,
      "APTO 1201, 2 suítes, 1 vaga, 73,25m² privativo": 1050194.58,
      "APTO 1203, 2 suítes, 1 vaga, 77,05m² privativo": 997974.96,
      "APTO 1204, 2 suítes, 1 vaga, 79,55m² privativo": 1003777.14,
      "APTO 1301, 2 suítes, 1 vaga, 73,25m² privativo": 1064700.03,
      "APTO 1302, 2 suítes, 1 vaga, 73,45m² privativo": 1076304.39,
    },
    obrasIniciadas: true,
  },

  Catalunya: {
    plantas: [
      "APTO 602, 3 suítes, 2 vagas, 141,00m² privativo",
      "APTO 701, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 801, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 901, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 902, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 1001, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 1002, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 1101, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 1102, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 1201, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 1202, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 1501, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 1502, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 1601, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 2001, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 2002, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 2101, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 2102, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 2201, 3 suítes, 2 vagas, 113,93m² privativo",
      "APTO 2202, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 2302, 2 suítes, 2 vagas, 80,34m² privativo",
      "APTO 2402, 2 suítes, 2 vagas, 80,34m² privativo",
    ],
    valores: {
      "APTO 602, 3 suítes, 2 vagas, 141,00m² privativo": 1804477.98,
      "APTO 701, 3 suítes, 2 vagas, 113,93m² privativo": 1465050.45,
      "APTO 801, 3 suítes, 2 vagas, 113,93m² privativo": 1479555.9,
      "APTO 901, 3 suítes, 2 vagas, 113,93m² privativo": 1494061.35,
      "APTO 902, 2 suítes, 2 vagas, 80,34m² privativo": 1096612.02,
      "APTO 1001, 3 suítes, 2 vagas, 113,93m² privativo": 1508566.8,
      "APTO 1002, 2 suítes, 2 vagas, 80,34m² privativo": 1111117.47,
      "APTO 1101, 3 suítes, 2 vagas, 113,93m² privativo": 1523072.25,
      "APTO 1102, 2 suítes, 2 vagas, 80,34m² privativo": 1125622.92,
      "APTO 1201, 3 suítes, 2 vagas, 113,93m² privativo": 1537577.7,
      "APTO 1202, 2 suítes, 2 vagas, 80,34m² privativo": 1140128.37,
      "APTO 1501, 3 suítes, 2 vagas, 113,93m² privativo": 1581094.05,
      "APTO 1502, 2 suítes, 2 vagas, 80,34m² privativo": 1183644.72,
      "APTO 1601, 3 suítes, 2 vagas, 113,93m² privativo": 1595599.5,
      "APTO 2001, 3 suítes, 2 vagas, 113,93m² privativo": 1653621.3,
      "APTO 2002, 2 suítes, 2 vagas, 80,34m² privativo": 1256171.97,
      "APTO 2101, 3 suítes, 2 vagas, 113,93m² privativo": 1668126.75,
      "APTO 2102, 2 suítes, 2 vagas, 80,34m² privativo": 1270677.42,
      "APTO 2201, 3 suítes, 2 vagas, 113,93m² privativo": 1682632.2,
      "APTO 2202, 2 suítes, 2 vagas, 80,34m² privativo": 1285182.87,
      "APTO 2302, 2 suítes, 2 vagas, 80,34m² privativo": 1299688.32,
      "APTO 2402, 2 suítes, 2 vagas, 80,34m² privativo": 1314193.77,
    },
    obrasIniciadas: false,
  },
};

const empreendimentosSelect = document.getElementById("empreendimentos");
const plantasSelect = document.getElementById("plantas");
const valorImovelSpan = document.querySelector(".valorImovel span");
const valorEntradaRange = document.getElementById("valorEntrada");
const spanValorAtualEntrada = document.getElementById("spanValorAtualEntrada");
const valorMinSpan = document.getElementById("valorMin");
const valorMaxSpan = document.getElementById("valorMax");
const parcelasRange = document.getElementById("parcelas");
const valorAtualParcela = document.getElementById("valorAtualParcela");
const valorMinParcelasSpan = document.getElementById("valorMinParcelas");
const valorMaxParcelasSpan = document.getElementById("valorMaxParcelas");
const mensagemEntradaMaior = document.getElementById("mensagemEntradaMaior");
const entradaMaiorRadio = document.getElementById("entradaMaior");
const telefoneInput = document.getElementById("telefone");

const valorReforco = 25000;
const numeroDeParcelasReforco = 12;
const valorTotalDoReforco = valorReforco * numeroDeParcelasReforco;

let valorAtualImovel = 0; // Valor inicial do imóvel
let valorAtualEntrada = 0; // Valor inicial da entrada
let maxParcelas = 1; // Para evitar divisão por zero

// Função para inicializar os selects com opções default
function inicializarSelects() {
  empreendimentosSelect.innerHTML =
    '<option value="">Selecione um empreendimento</option>';
  plantasSelect.innerHTML = '<option value="">Selecione uma planta</option>';

  for (const empreendimento in empreendimentos) {
    const option = document.createElement("option");
    option.value = empreendimento;
    option.textContent = empreendimento;
    empreendimentosSelect.appendChild(option);
  }
}

// Atualiza as plantas de acordo com o empreendimento selecionado
function atualizarPlantas() {
  const empreendimentoSelecionado = empreendimentosSelect.value;
  plantasSelect.innerHTML = '<option value="">Selecione uma planta</option>'; // Adiciona a opção inicial

  if (empreendimentoSelecionado && empreendimentos[empreendimentoSelecionado]) {
    const plantas = empreendimentos[empreendimentoSelecionado].plantas;
    plantas.forEach((planta) => {
      const option = document.createElement("option");
      option.value = planta;
      option.textContent = planta;
      plantasSelect.appendChild(option);
    });
  }

  // Limpar valores ao alterar empreendimento
  limparValores();

  // Garantir que o valor do range seja no meio
  parcelasRange.value = Math.round(
    (parseInt(parcelasRange.min) + parseInt(parcelasRange.max)) / 2
  );

  // Exibe o valor inicial da parcela
  spanNumeroParcelas.textContent = "0x"; // Exibe 0 como o número de parcelas inicialmente

  // Atualiza o valor da parcela de acordo com o novo empreendimento (valor padrão)
  valorAtualParcela.textContent = "R$ 0,00"; // Exibe o valor padrão para parcela

  // Verifica se uma planta foi selecionada
  if (plantasSelect.value !== "") {
    valorEntradaRange.disabled = false; // Habilita o slider de Entrada
    parcelasRange.disabled = false; // Habilita o slider de Parcela
  } else {
    valorEntradaRange.disabled = true; // Desabilita o slider de Entrada
    parcelasRange.disabled = true; // Desabilita o slider de Parcela
  }
}

// Função de alteração da planta (verifica se a planta foi selecionada)
plantasSelect.addEventListener("change", () => {
  if (plantasSelect.value === "") {
    valorEntradaRange.disabled = true; // Desabilita o slider de Entrada se não houver planta selecionada
    parcelasRange.disabled = true; // Desabilita o slider de Parcela se não houver planta selecionada
  } else {
    valorEntradaRange.disabled = false; // Habilita o slider de Entrada se houver planta selecionada
    parcelasRange.disabled = false; // Habilita o slider de Parcela se houver planta selecionada
  }
});

// Exibe o valor do imóvel selecionado
function mostrarValorImovel() {
  const empreendimentoSelecionado = empreendimentosSelect.value;
  const plantaSelecionada = plantasSelect.value;

  if (empreendimentoSelecionado && plantaSelecionada) {
    const valores = empreendimentos[empreendimentoSelecionado].valores;
    valorAtualImovel = valores[plantaSelecionada] || 0;

    if (valorAtualImovel) {
      valorImovelSpan.textContent = `R$ ${valorAtualImovel.toLocaleString(
        "pt-BR",
        { minimumFractionDigits: 2 }
      )}`;

      // Calcular range de entrada
      const valorMinEntrada = (valorAtualImovel * 0.2).toFixed(2);
      const valorMaxEntrada = (valorAtualImovel * 0.5).toFixed(2);

      valorEntradaRange.min = valorMinEntrada;
      valorEntradaRange.max = valorMaxEntrada;
      valorEntradaRange.value = valorMinEntrada;
      valorAtualEntrada = parseFloat(valorMinEntrada);

      spanValorAtualEntrada.textContent = `R$ ${valorAtualEntrada.toLocaleString(
        "pt-BR",
        { minimumFractionDigits: 2 }
      )}`;
      valorMinSpan.textContent = `R$ ${parseFloat(
        valorMinEntrada
      ).toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`;
      valorMaxSpan.textContent = `R$ ${parseFloat(
        valorMaxEntrada
      ).toLocaleString("pt-BR", { minimumFractionDigits: 2 })}`;

      // Calcular número máximo de parcelas
      const empreendimentoInfo = empreendimentos[empreendimentoSelecionado];
      maxParcelas = empreendimentoInfo.obrasIniciadas ? 72 : 80;
      parcelasRange.max = maxParcelas;
      parcelasRange.value = maxParcelas;
      spanNumeroParcelas.textContent = maxParcelas;

      atualizarParcelas();
      atualizarMensagemEntradaMaior();
      atualizarMensagemParcelaMaior();
    } else {
      limparValores();
    }
  }
}

// Desabilitar os sliders inicialmente
valorEntradaRange.disabled = true;
parcelasRange.disabled = true;

// Atualiza o valor da entrada baseado no input do usuário
function atualizarValorEntrada() {
  valorAtualEntrada = parseFloat(valorEntradaRange.value);
  spanValorAtualEntrada.textContent = `R$ ${valorAtualEntrada.toLocaleString(
    "pt-BR",
    { minimumFractionDigits: 2 }
  )}`;
  atualizarParcelas();
}

// Atualiza os valores das parcelas
function atualizarParcelas() {
  const numeroParcelas = parseInt(parcelasRange.value);
  const valorRestante =
    valorAtualImovel - valorAtualEntrada - valorTotalDoReforco;

  // Calculando o valor de cada parcela com 2 casas decimais
  let valorParcela = valorRestante / numeroParcelas;
  valorParcela = parseFloat(valorParcela.toFixed(2)); // Arredonda para 2 casas decimais

  // Calculando o total das parcelas
  const totalParcelas = valorParcela * numeroParcelas;

  // Calcular a diferença, que será adicionada à entrada
  const valorDif = valorRestante - totalParcelas;

  // Atualiza a entrada com o valor da diferença
  valorAtualEntrada += valorDif;

  // Atualiza os elementos na interface
  spanNumeroParcelas.textContent = `${numeroParcelas}x`;
  valorAtualParcela.textContent = `R$ ${valorParcela.toLocaleString("pt-BR", {
    minimumFractionDigits: 2,
  })}`;

  // Atualiza o valor da entrada
  spanValorAtualEntrada.textContent = `R$ ${valorAtualEntrada.toLocaleString(
    "pt-BR",
    { minimumFractionDigits: 2 }
  )}`;

  // Atualiza a proposta do cliente
  atualizarPropostaCliente();
  // Atualiza a mensagem da Entrada Maior
  atualizarMensagemEntradaMaior();
}

function atualizarPropostaCliente() {
  const propostaClienteInput = document.getElementById("propostaCliente");
  const mensagemPropostaCliente = document.getElementById(
    "mensagemPropostaCliente"
  );

  // Calcular o valor restante considerando o reforço
  const numeroParcelas = parseInt(parcelasRange.value) || 0;
  const valorRestante =
    valorAtualImovel - valorAtualEntrada - valorTotalDoReforco;

  // Calcular o valor de cada parcela
  const valorParcela = numeroParcelas > 0 ? valorRestante / numeroParcelas : 0;
  const valorParcelaArredondado = parseFloat(valorParcela.toFixed(2));

  // Ajustar a entrada com base na diferença
  const totalParcelas = valorParcelaArredondado * numeroParcelas;
  const diferenca =
    valorAtualImovel -
    (valorAtualEntrada + totalParcelas + valorTotalDoReforco);
  const entradaComAjuste = valorAtualEntrada + diferenca;

  // Gera a mensagem da proposta
  const mensagem =
    `Entrada: R$ ${entradaComAjuste.toLocaleString("pt-BR", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    })},\n` +
    `Parcela: ${numeroParcelas}x de R$ ${valorParcelaArredondado.toLocaleString(
      "pt-BR",
      {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }
    )}, \n` +
    `Reforço semestral: ${numeroDeParcelasReforco}x de R$ ${valorReforco.toLocaleString(
      "pt-BR",
      { minimumFractionDigits: 2, maximumFractionDigits: 2 }
    )}`;

  // Atualizar a interface
  propostaClienteInput.value = mensagem; // Atualiza o valor do input
  mensagemPropostaCliente.textContent = mensagem; // Exibe a mensagem no span
}

// Atualiza a mensagem para "Entrada Maior"
function atualizarMensagemEntradaMaior() {
  if (!valorAtualImovel || !valorAtualEntrada || !parcelasRange.value) {
    const mensagemEntradaMaior = document.getElementById(
      "mensagemEntradaMaior"
    );
    if (mensagemEntradaMaior) {
      mensagemEntradaMaior.innerHTML =
        "Entrada: R$ 0,00 <br>Parcela: 0x de R$ 0,00 <br>Reforço semestral: 12x de R$ 25.000,00";
    }
    return;
  }

  // Calcular a entrada com acréscimo de 15%
  let entradaComAcrescimo = valorAtualEntrada * 1.5;

  // Determinar o número de parcelas
  const numeroParcelas = parseInt(parcelasRange.value) || 0;

  // Calcular o valor restante considerando o reforço
  const valorRestante =
    valorAtualImovel - entradaComAcrescimo - valorTotalDoReforco;

  // Calcular o valor de cada parcela
  let valorParcelaEntradaMaior = valorRestante / numeroParcelas || 0;
  valorParcelaEntradaMaior = parseFloat(valorParcelaEntradaMaior.toFixed(2)); // Arredondar

  // Calcular o total das parcelas
  const totalParcelas = valorParcelaEntradaMaior * numeroParcelas;

  // Ajustar a entrada para compensar diferenças
  const diferenca =
    valorAtualImovel -
    (entradaComAcrescimo + totalParcelas + valorTotalDoReforco);
  entradaComAcrescimo += diferenca;

  // Atualizar a mensagem
  const mensagem =
    `Entrada: R$ ${entradaComAcrescimo.toLocaleString("pt-BR", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    })}, \n` +
    `Parcela: ${numeroParcelas}x R$ ${valorParcelaEntradaMaior.toLocaleString(
      "pt-BR",
      {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }
    )}, \n` +
    `Reforço semestral: ${numeroDeParcelasReforco}x de R$ ${valorReforco.toLocaleString(
      "pt-BR",
      { minimumFractionDigits: 2, maximumFractionDigits: 2 }
    )}`;

  // Exibir a mensagem na interface
  const mensagemEntradaMaior = document.getElementById("mensagemEntradaMaior");
  if (mensagemEntradaMaior) {
    mensagemEntradaMaior.textContent = mensagem;
  }
}

function atualizarMensagemParcelaMaior() {
  if (!valorAtualImovel || !valorAtualEntrada || !parcelasRange.value) {
    const mensagemParcelaMaior = document.getElementById(
      "mensagemParcelaMaior"
    );
    if (mensagemParcelaMaior) {
      mensagemParcelaMaior.innerHTML =
        "Entrada: R$ 0,00 <br> Parcela: 0x de R$ 0,00 <br>Reforço semestral: 12x de R$ 25.000,00";
    }
    return;
  }

  // Garantir que a entrada seja pelo menos 20% do valor do imóvel
  const entradaMinima = valorAtualImovel * 0.2;
  let entradaComAjuste = Math.max(valorAtualEntrada, entradaMinima);

  // Determinar o número de parcelas para "Parcela Maior"
  const numeroParcelasCliente = parseInt(parcelasRange.value) || 0;
  const numeroParcelasParcelaMaior =
    numeroParcelasCliente > 1
      ? Math.max(Math.floor(numeroParcelasCliente / 2), 1)
      : 1; // Garantir pelo menos uma parcela

  // Calcular o valor restante a ser parcelado (considerando o reforço)
  const valorRestante =
    valorAtualImovel - entradaComAjuste - valorTotalDoReforco;

  // Calcular o valor de cada parcela
  let valorParcelaParcelaMaior =
    valorRestante / numeroParcelasParcelaMaior || 0;
  valorParcelaParcelaMaior = parseFloat(valorParcelaParcelaMaior.toFixed(2));

  // Obter o valor da parcela da função "Entrada Maior" para comparação
  const valorParcelaEntradaMaior =
    (valorAtualImovel - valorAtualEntrada - valorTotalDoReforco) /
    numeroParcelasCliente;

  // Garantir que o valor da parcela maior seja superior ao da proposta do cliente,
  // exceto se o número de parcelas for 1
  if (
    numeroParcelasParcelaMaior > 1 &&
    valorParcelaParcelaMaior <= valorParcelaEntradaMaior
  ) {
    valorParcelaParcelaMaior = valorParcelaEntradaMaior * 1.2; // Incremento de 20% se necessário
  }

  // Ajustar a entrada para compensar diferenças
  const totalParcelas = valorParcelaParcelaMaior * numeroParcelasParcelaMaior;
  const diferenca =
    valorAtualImovel - (entradaComAjuste + totalParcelas + valorTotalDoReforco);
  entradaComAjuste += diferenca;

  // Atualizar a mensagem
  const mensagem =
    `Entrada: R$ ${entradaComAjuste.toLocaleString("pt-BR", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    })}, \n` +
    `Parcela: ${numeroParcelasParcelaMaior}x R$ ${valorParcelaParcelaMaior.toLocaleString(
      "pt-BR",
      {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }
    )}, \n` +
    `Reforço semestral: ${numeroDeParcelasReforco}x de R$ ${valorReforco.toLocaleString(
      "pt-BR",
      { minimumFractionDigits: 2, maximumFractionDigits: 2 }
    )}`;

  // Exibir a mensagem na interface
  const mensagemParcelaMaior = document.getElementById("mensagemParcelaMaior");
  if (mensagemParcelaMaior) {
    mensagemParcelaMaior.textContent = mensagem;
  }
}

// Inicializa a mensagem padrão para "Parcela Maior"
function inicializarMensagemParcelaMaior() {
  const mensagemParcelaMaior = document.getElementById("mensagemParcelaMaior");
  if (mensagemParcelaMaior) {
    mensagemParcelaMaior.innerHTML =
      "Entrada: R$ 0,00 <br> Parcela: 0x de R$ 0,00 <br>Reforço semestral: 12x de R$ 25.000,00";
  }
}

// Inicializa a mensagem com valores padrão 0
function inicializarMensagemProposta() {
  const propostaClienteInput = document.getElementById("propostaCliente");
  const mensagem =
    "Entrada: R$ 0,00 <br> Parcela: 0x de R$ 0,00 <br> Reforço semestral: 12x de R$ 25.000,00";
  propostaClienteInput.value = mensagem; // Atualiza o valor do input
  document.getElementById("mensagemPropostaCliente").innerHTML = mensagem;
}

function selecionarRadioAoClicar(classeDiv, idRadio) {
  const divs = document.querySelectorAll(`.${classeDiv}`);

  divs.forEach((div) => {
    div.addEventListener("click", () => {
      const radio = document.getElementById(idRadio);
      radio.checked = true;
    });
  });
}

// Chamando a função para cada conjunto de radio button
selecionarRadioAoClicar("opcaoProposta", "propostaCliente");
selecionarRadioAoClicar("opcaoEntradaMaior", "entradaMaior");
selecionarRadioAoClicar("opcaoParcelaMaior", "parcelaMaior");

// Limpa os valores exibidos
function limparValores() {
  valorImovelSpan.textContent = "";
  valorMinSpan.textContent = "";
  valorMaxSpan.textContent = "";
  spanValorAtualEntrada.textContent = "";
  parcelasRange.value = 0;
  spanNumeroParcelas.textContent = "";
  valorAtualParcela.textContent = "";
  valorMinParcelasSpan.textContent = "";
  valorMaxParcelasSpan.textContent = "";
}

// Função para validar os campos do formulário
function validarCamposContato() {
  // Limpar as mensagens de erro
  const erros = document.querySelectorAll(".erro");
  erros.forEach((erro) => (erro.textContent = ""));

  let valido = true;

  // Validar nome
  const nome = document.getElementById("nome");
  if (nome.value.trim() === "") {
    document.querySelector("#nome + .erro").textContent =
      "Nome não pode estar em branco.";
    valido = false;
  }

  // Validar e-mail
  const email = document.getElementById("email");
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email.value)) {
    document.querySelector("#email + .erro").textContent =
      "Por favor, insira um e-mail válido.";
    valido = false;
  }

  // Validar telefone
  const telefone = document.getElementById("telefone");
  const telefoneRegex = /^\(\d{2}\) \d{4}\d{4}$/;
  if (!telefoneRegex.test(telefone.value)) {
    document.querySelector("#telefone + .erro").textContent =
      "Telefone inválido. Exemplo: (11) 9876-5432";
    valido = false;
  }

  // Validar se o empreendimento foi selecionado
  const empreendimento = document.getElementById("empreendimentos").value;
  if (!empreendimento) {
    document.querySelector("#empreendimentos + .erro").textContent =
      "Por favor, selecione um empreendimento.";
    valido = false;
  }

  // Validar se a planta foi selecionada
  const planta = document.getElementById("plantas").value;
  if (!planta) {
    document.querySelector("#plantas + .erro").textContent =
      "Por favor, selecione uma planta.";
    valido = false;
  }

  // Validar opção selecionada
  const opcoes = document.querySelectorAll('input[name="opcoes"]');
  const opcaoSelecionada = Array.from(opcoes).some((opcao) => opcao.checked); // Verifica se algum dos radio buttons foi marcado

  if (!opcaoSelecionada) {
    document.querySelector(".opcoes .erro").textContent =
      "Por favor, selecione uma opção.";
    valido = false;
  }

  // Se todos os campos são válidos, gera a mensagem
  if (valido) {
    gerarMensagem();
  }

  return valido; // Retorna se o formulário é válido ou não
}

// Função para gerar a mensagem com os dados preenchidos
function gerarMensagem() {
  // Obter os valores dos campos de empreendimento, planta e valor do imóvel
  const empreendimento = document.getElementById("empreendimentos").value;
  const planta = document.getElementById("plantas").value;
  const valor = document.getElementById("valorImovel").textContent;

  // Obter a opção escolhida no rádio
  const opcaoSelecionada = document.querySelector(
    'input[name="opcoes"]:checked'
  );
  let opcao = "Nenhuma"; // Valor padrão, caso nenhuma opção seja escolhida

  if (opcaoSelecionada) {
    opcao = opcaoSelecionada.nextElementSibling.textContent.trim(); // Obtém o texto associado à opção escolhida
  }

  // Obter os dados de contato
  const nome = document.getElementById("nome").value;
  const email = document.getElementById("email").value;
  const telefone = document.getElementById("telefone").value;

  // Montar a mensagem
  const mensagem =
    `Empreendimento: ${empreendimento}\n` +
    `Planta: ${planta}\n` +
    `Valor do Imóvel: ${valor}\n` +
    `Opção escolhida: ${opcao}\n\n` +
    `Contato:\n` +
    `Nome: ${nome}\n` +
    `E-mail: ${email}\n` +
    `Telefone: ${telefone}`;

  // Codificar a mensagem para ser usada na URL
  const mensagemCodificada = encodeURIComponent(mensagem);

  // Criar a URL do WhatsApp com o número e a mensagem
  const numeroWhatsApp = "55" + "4797941413";
  const url = `https://wa.me/${numeroWhatsApp}?text=${mensagemCodificada}`;

  // Abrir o WhatsApp com a mensagem pronta
  window.open(url, "_blank");
}

function outraProposta() {
  const numeroWhatsApp = "55" + "4797941413";
  const url = `https://wa.me/${numeroWhatsApp}`;

  window.open(url, "_blank");
}

// Eventos
empreendimentosSelect.addEventListener("change", () => {
  atualizarPlantas();
  atualizarPropostaCliente();
});

plantasSelect.addEventListener("change", () => {
  mostrarValorImovel();
  atualizarPropostaCliente();
});

valorEntradaRange.addEventListener("input", () => {
  atualizarValorEntrada();
  atualizarPropostaCliente();
  atualizarMensagemEntradaMaior();
  atualizarMensagemParcelaMaior();
});

parcelasRange.addEventListener("input", () => {
  atualizarParcelas();
  atualizarPropostaCliente();
  atualizarMensagemEntradaMaior();
  atualizarMensagemParcelaMaior();
});

// Atualiza automaticamente se o valor da entrada ou das parcelas mudar
valorEntradaRange.addEventListener("input", () => {
  if (entradaMaiorRadio.checked) {
    atualizarMensagemEntradaMaior();
  }
});

parcelasRange.addEventListener("input", () => {
  if (entradaMaiorRadio.checked) {
    atualizarMensagemEntradaMaior();
  }
});

telefoneInput.addEventListener("input", () => {
  let telefone = telefoneInput.value.replace(/\D/g, ""); // Remove qualquer caractere não numérico

  // Formatação dinâmica
  if (telefone.length <= 2) {
    telefone = `(${telefone}`; // Formata o código de área
  } else if (telefone.length <= 6) {
    telefone = `(${telefone.slice(0, 2)}) ${telefone.slice(2)}`; // Formata com 6 caracteres
  } else {
    telefone = `(${telefone.slice(0, 2)}) ${telefone.slice(
      2,
      6
    )}${telefone.slice(6, 10)}`; // Remove hífen e mantém todos os números
  }

  telefoneInput.value = telefone; // Atualiza o valor do campo
});

// Inicialização
inicializarSelects();
inicializarMensagemProposta(); // Configura mensagem default
atualizarMensagemEntradaMaior();
atualizarMensagemParcelaMaior();
